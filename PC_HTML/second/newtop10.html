<!doctype html>
<html>
<header class="mui-bar mui-bar-nav">
  <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
  <h1 class="mui-title">互动排名</h1>
</header>

<head>
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta charset="UTF-8">
  <title></title>
  <!-- <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" /> -->
  <link href="../../css/mui.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="../../css/boostrap/bootstrap.css" />
  <script src="../../js/jquery-3.3.1.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
</head>
<style type="text/css">
  .white-block {
    margin-bottom: 20px;
    width: 320px;
    height: 200px;
    border-radius: 20px;
    box-shadow: 10px 10px 10px rgb(0, 0, 0, 0.4);
    background: white;
    display: inline-block;
  }

  h4 {
    padding-left: 0px;
    padding-top: 30px;
  }

  body {
    background: linear-gradient(to right, #67c8b8, #3e87c8);
  }
</style>

<body>
  <script src="../../js/mui.min.js"></script>
  <script type="text/javascript">
    mui.init()
  </script>
  <div id="contentBox" style="text-align: center;margin-top: 60px;">
    <!-- <div class="white-block" style="margin-top: 60px;">
				<div class="row">
					<div class="col-xs-6">
						<img src="../../img/虾饺.jpg" style="width: 230px;height: 200px;border-radius: 20px;padding: 10px 10px 10px 10px;" />
					</div>
					<div class="col-xs-6">
						<div class="row">
							<img src="../../img/guanjun.svg" style="display: inline-block;width: 40px;height: 40px;" />
							<h4 style="display: inline-block;">绝味虾饺</h4>
						</div>
						<div class="row" style="padding-left:20px ;">
							<p>获得票数：888票</p>
						</div>
					</div>
				</div>
			</div> -->

  </div>
</body>
<script type="text/javascript">
  //定义写log方法/////////////////////////////////////////
  var logApiUrl = localStorage.getItem('logApiUrl')
  var JWTtoken = localStorage.getItem('JWTtoken')
  var appCode = localStorage.getItem('appCode')
  var source = localStorage.getItem('source')

  //定义写log方法
  function writeLogFun(dataInput) {
    var pararms = {
      policeId: dataInput.policeId,
      userName: dataInput.userName,
      cardNo: dataInput.cardNo,
      orgName: dataInput.orgName,
      orgCode: dataInput.orgCode,
      requestId: dataInput.requestId,
      sessionId: dataInput.sessionId,
      terminalIp: '20.97.10.' + Math.ceil(Math.random() * 100),
      logType: dataInput.logType,
      module: dataInput.module,
      params: dataInput.params + '',
      formatParam: dataInput.formatParam + '',
      url: dataInput.url,
      uri: dataInput.uri,
      content: dataInput.content,
      response: dataInput.response,
      responseType: dataInput.responseType,
      imei: dataInput.imei,
      business: dataInput.business,
      mac: dataInput.mac,
      responseTime: dataInput.responseTime + '',
      result: dataInput.result,
      errorCode: dataInput.errorCode,
      errorLog: dataInput.errorLog,
      sourceIp: dataInput.sourceIp,
      sourcePort: dataInput.sourcePort,
      destIp: dataInput.destIp,
      destPort: dataInput.destPort,
      appCode: appCode,
      source: source,
      recordTime: dataInput.recordTime + '',
      isSystemLog: dataInput.isSystemLog
    }

    $.ajax({
      url: logApiUrl + "/logs/operateLog",
      contentType: 'application/json',
      data: JSON.stringify(pararms),
      type: 'post',
      async: false,
      crossDomain: true,
      headers: {
        'LinkJWTAuth': 'Bearer ' + JWTtoken
      },
      success: function (result) {
        //响应时间
        // var timeSpan = (new Date()).getTime() - startTime
        // console.log('timeSpan', timeSpan, startTime, result)
      }
    });
  }
  ////////////////////
  //记录时间
  var startTime = (new Date()).getTime()
  var timeSpan = null;
  /////////////
  var replace_url = localStorage.getItem("replace_url");
  var post_url_all_header = localStorage.getItem("url_header");
  var targetUrl = post_url_all_header + "/Interface/Common/GetStaffVotes.ashx";
  $.ajax({
    url: targetUrl,
    data: {
      'top': '10'
    },
    dataType: 'json', //【这里要小心啊，不要用jsonp，一定是json】
    type: 'get',
    async: false,
    crossDomain: true, //【这个很重要，一定要加】
    success: function (result) {
      console.log(result)
      //响应时间
      timeSpan = (new Date()).getTime() - startTime
      result.cookbooks.forEach(function (currentValue, currentIndex, currentArray) {
        switch (currentIndex) {
          case 0:
            var img = '<img src="../../img/guanjun.svg" style="display: inline-block;width: 40px;height: 40px;"/>'
            break;
          case 1:
            var img = '<img src="../../img/yajun.svg" style="display: inline-block;width: 40px;height: 40px;"/>'
            break;
          case 2:
            var img = '<img src="../../img/jijun.svg" style="display: inline-block;width: 40px;height: 40px;"/>'
            break;
          case 3:
            var img =
              '<img src="../../img/icon-test.svg" style="display: inline-block;width: 30px;height: 30px;margin-bottom:10px;margin-right:5px;"/>'
            break;
          case 4:
            var img =
              '<img src="../../img/icon-test_1.svg" style="display: inline-block;width: 30px;height: 30px;margin-bottom:10px;margin-right:5px;"/>'
            break;
          case 5:
            var img = '<img src="../../img/6.svg" style="display: inline-block;width: 30px;height: 30px;"/>'
            break;
          case 6:
            var img = '<img src="../../img/8.svg" style="display: inline-block;width: 30px;height: 30px;"/>'
            break;
          case 7:
            var img = '<img src="../../img/7.svg" style="display: inline-block;width: 30px;height: 30px;"/>'
            break;
          case 8:
            var img =
              '<img src="../../img/9.svg" style="display: inline-block;width: 30px;height: 30px;margin-bottom:10px;margin-right:5px;"/>'
            break;
          case 9:
            var img =
              '<img src="../../img/10.svg" style="display: inline-block;width: 30px;height: 30px;margin-bottom:10px;margin-right:5px;"/>'
            break;
        }

        var appendThing =
          '<div class="white-block" style="margin-top: 10px;"><div class="row"><div class="col-xs-6"><img src="' + currentValue.Icon.replace(replace_url, '20.96.28.147/zhct') +
          '" style="width: 190px;height: 170px;border-radius: 20px;padding: 15px 10px 10px 10px;"/></div><div class="col-xs-6"><div class="row">' +
          img +
          '<h4 style="display: inline-block;">' + currentValue.StaffName +
          '</h4></div><div class="row" style="padding-left:20px ;"><p style="margin-top:10px;">投出票数：' + currentValue.Votes +
          '票</p></div></div></div></div>'
        $("#contentBox").append(appendThing);
      });


      ////////////
      /////////////加日志//////////////////
      ///////日志代码

      //获取警员ID
      var loginId = localStorage.getItem("PCNum");
      var pcName = localStorage.getItem("Name");
      var orgName = localStorage.getItem("WorkUnit");
      var idtifiNum = localStorage.getItem("personImformationId");
      var dataInput = {
        policeId: loginId,
        userName: pcName,
        cardNo: idtifiNum,
        orgName: orgName,
        orgCode: orgName,
        requestId: 'w223dc10-905e-4fa7-8680-465b2549' + Math.ceil(Math.random() * 1000),
        sessionId: '0PO98968A9BE3F434A177933407B' + Math.ceil(Math.random() * 1000),
        terminalIp: '',
        logType: '1',
        module: '互动排名',
        params: '{"top":"10"}',
        formatParam: '{"排名数量":"10"}',
        url: post_url_all_header,
        uri: '/Interface/Common/GetCookbookVotes.ashx',
        content: '',
        response: JSON.stringify(result),
        responseType: '1',
        responseTime: timeSpan,
        imei: '',
        business: '已办公文',
        mac: '',
        result: '成功',
        errorCode: '',
        errorLog: '',
        sourceIp: '20.97.10.' + Math.ceil(Math.random() * 100),
        sourcePort: '7878',
        destIp: '20.96.28.147',
        destPort: '7029',
        appCode: 'com.bingo.zhjw',
        source: '505',
        recordTime: (new Date()).getTime(),
        isSystemLog: '0',
      }
      ////////////////////////////
      writeLogFun(dataInput)
    }
  });
</script>

</html>